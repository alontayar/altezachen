<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>אלטע זאכן — Type Tester</title>

<!-- ===== FONTS (root; no folders) ===== -->
<style>
@font-face{
  font-family:"AlteZachen-Normal";
  src:url("AlteZachen-Normal.woff2") format("woff2"),
      url("AlteZachen-Normal.woff") format("woff"),
      url("AlteZachen-Normal.otf") format("opentype");
  font-display:swap;
}
@font-face{
  font-family:"AlteZachen-HalfWide";
  src:url("AlteZachen-HalfWide.woff2") format("woff2"),
      url("AlteZachen-HalfWide.woff") format("woff"),
      url("AlteZachen-HalfWide.otf") format("opentype");
  font-display:swap;
}
@font-face{
  font-family:"AlteZachen-Wide";
  src:url("AlteZachen-Wide.woff2") format("woff2"),
      url("AlteZachen-Wide.woff") format("woff"),
      url("AlteZachen-Wide.otf") format("opentype");
  font-display:swap;
}
@font-face{
  font-family:"AlteZachen-Random";
  src:url("AlteZachen-Random.woff2") format("woff2"),
      url("AlteZachen-Random.woff") format("woff"),
      url("AlteZachen-Random.otf") format("opentype");
  font-display:swap;
}

/* ===== Base ===== */
:root{
  --red:#ff0000;
  --black:#000;
  --white:#fff;
  --grey:#eceff3; /* חלון אפור עדין */
}
html,body{margin:0;background:#fff;color:#000;overflow-x:hidden}
body{font-family:"AlteZachen-Normal", system-ui, -apple-system, "Segoe UI", Arial, sans-serif}

/* כותרת מודבקת למעלה (פשוטה, שחור/אדום/לבן בלבד) — אופציונלי */
.header{
  position:sticky; top:0; z-index:20;
  background:var(--red); color:#000; border-bottom:1px solid #000;
  display:flex; justify-content:center; align-items:center;
  padding:10px 12px;
}
.header a{color:#000;text-decoration:none;font-weight:600}

/* העטיפה הראשית של הטייפ־טסטר */
.wrap{
  padding:clamp(18px,4vw,40px) clamp(8px,3vw,24px);
}

/* הכרטיס האפור */
.tester{
  width:min(98vw, 1600px);
  margin-inline:auto;
  background:var(--grey);
  border-radius:16px;
  padding: clamp(10px, 1.6vw, 16px);
  display:flex; flex-direction:column; gap:var(--gap, 8px);
  box-sizing:border-box;
}

/* לשוניות משקל – ממורכז */
.weights{
  display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap;
}
.weight-btn{
  font-family:"AlteZachen-HalfWide", system-ui, sans-serif;
  font-size: clamp(12px,1.2vw,16px);
  line-height:1; padding:9px 12px;
  border:1px solid var(--black); border-radius:8px;
  background:var(--white); color:var(--black);
  cursor:pointer; user-select:none;
}
.weight-btn.active{background:var(--red); color:#fff; border-color:var(--red)}
.weight-btn:focus{outline:2px solid #0000;}

/* חלון טקסט — רוחב קבוע (100%), גובה זורם מעט, מרכז מלא */
.window{
  width:100%; border-radius:12px; overflow:hidden;
  display:flex; align-items:center; justify-content:center;
  transition:height .16s ease;
}

/* טקסט עיקרי */
.text{
  --f: 180px;
  font-size: var(--f);
  line-height:1;
  font-kerning:normal;
  font-feature-settings:"kern" 1, "liga" 1;
  -webkit-font-smoothing:antialiased;
  text-rendering:optimizeLegibility;

  font-family:"AlteZachen-Random", system-ui, sans-serif;
  color:#000; background:transparent;

  outline:none; border:none; caret-color:#000;

  white-space:nowrap; text-align:center; direction:rtl;
  display:block; max-width:100%;
  padding-inline: clamp(4px, 1vw, 8px);
  padding-bottom: 10px;           /* שמירה לדסנדרים */
  transform: translateY(-2%);     /* “הרמה” אופטית קלה */
}

/* פסקה מתחת (אופציונלי) */
.help{
  text-align:center; margin-top:8px; font-size:12px; color:#000;
  font-family:Arial, Helvetica, sans-serif;
}

/* מובייל */
@media (max-width:700px){
  .tester{width:calc(100vw - 12px)}
  .weight-btn{font-size: clamp(12px,3.8vw,15px); padding:8px 10px}
}
</style>
</head>
<body>

<header class="header">
  <a href="https://hafontia.com" target="_blank" rel="noopener">הפונטיה</a>
</header>

<main class="wrap">

  <section class="tester" id="tester"
    data-default-font="AlteZachen-Random"
    aria-label="טייפ־טסטר">
    
    <div class="weights" role="tablist" aria-label="משקלים">
      <button class="weight-btn" role="tab" aria-selected="false" data-font="AlteZachen-Normal">נורמל</button>
      <button class="weight-btn" role="tab" aria-selected="false" data-font="AlteZachen-HalfWide">חצי־רחב</button>
      <button class="weight-btn" role="tab" aria-selected="false" data-font="AlteZachen-Wide">רחב</button>
      <button class="weight-btn active" role="tab" aria-selected="true"  data-font="AlteZachen-Random">רנדום</button>
    </div>

    <div class="window" id="win">
      <div id="txt" class="text" contenteditable="true" spellcheck="false" aria-label="עריכת טקסט">אלטע זאכן</div>
    </div>

    <p class="help">קיצורים: 1–4 להחלפת משקל · ←/→ להגדלה/הקטנה עדינה</p>
  </section>

</main>

<script>
(function(){
  const BASE_TEXT = 'אלטע זאכן'; // baseline: ממלא את החלון במקסימום (תלוי מסך)
  const tester  = document.getElementById('tester');
  const txtNode = document.getElementById('txt');
  const winNode = document.getElementById('win');
  const tabs    = Array.from(tester.querySelectorAll('.weight-btn'));
  const mqMobile= window.matchMedia('(max-width:700px)');
  const defFont = tester.getAttribute('data-default-font') || 'AlteZachen-Random';

  // תקרות בטיחות (נגד חיתוך קיצוני)
  const FONT_MAX_DESKTOP = 1500;
  const FONT_MAX_MOBILE  = 520;

  let baselineSize = null;      // הגודל של "אלטע זאכן" למסך/משקל נוכחי
  let nudge        = 0;         // דחיפות עדינות (←/→)

  // מודד נסתר
  const meas = document.createElement('span');
  Object.assign(meas.style, {
    position:'absolute', visibility:'hidden', pointerEvents:'none',
    whiteSpace:'nowrap', lineHeight:'1'
  });
  document.body.appendChild(meas);

  // utils: מימדים זמינים (פנימיים)
  function availW(){
    const cs = getComputedStyle(txtNode);
    const padX = parseFloat(cs.paddingInlineStart) + parseFloat(cs.paddingInlineEnd);
    return Math.max(10, winNode.clientWidth - padX - 2);
  }
  function availH(){
    return Math.max(10, winNode.clientHeight - 8);
  }

  // חישוב גודל שמתאים גם לרוחב וגם לגובה
  function fitSize(text, w, h){
    const cs = getComputedStyle(txtNode);
    meas.style.fontFamily    = cs.fontFamily;
    meas.style.letterSpacing = cs.letterSpacing;
    meas.textContent         = (text || '').trim() || BASE_TEXT;

    const FONT_MAX = mqMobile.matches ? FONT_MAX_MOBILE : FONT_MAX_DESKTOP;
    let lo=8, hi=FONT_MAX, best=16;
    while(lo<=hi){
      const mid = Math.floor((lo+hi)/2);
      meas.style.fontSize = (mid + nudge) + 'px';
      const r = meas.getBoundingClientRect();
      const fits = (r.width <= w) && (r.height * 1.06 <= h);
      if (fits){ best = mid; lo = mid+1; } else { hi = mid-1; }
    }
    return Math.max(8, best + nudge);
  }

  // קביעת משקל + חישוב baseline מחדש
  function setFamily(ff){
    txtNode.style.fontFamily = `"${ff}", system-ui, sans-serif`;
    baselineSize = fitSize(BASE_TEXT, availW(), baselineH());
    render();
  }

  // גובה חלון מבוסס תוכן: קצר -> גבוה; ארוך -> נמוך (תנועה מלמטה בלבד)
  function setWindowHeight(){
    const t = (txtNode.textContent || '').trim() || BASE_TEXT;
    const len = [...t].length;
    const isMobile = mqMobile.matches;
    const minVh = isMobile ? 20 : 16;
    const maxVh = isMobile ? 32 : 26;
    const shrink = Math.min(12, Math.max(0, (len - 9) * 0.5));
    let vh = maxVh - shrink;
    if (vh < minVh) vh = minVh;
    winNode.style.height = vh + 'vh';
  }

  // הגובה להתאמת פונט (אחרי שנקבע vh)
  function baselineH(){
    return Math.max(10, winNode.clientHeight - 8);
  }

  // ריווח בין לשוניות לטקסט
  function setGap(){
    const t = (txtNode.textContent || '').trim() || BASE_TEXT;
    const len = [...t].length;
    tester.style.setProperty('--gap', (len <= 9 ? 4 : 8) + 'px');
  }

  // הרינדור הראשי: קובע גובה חלון, ואז מתאים פונט לפי רוחב/גובה, עם הגבלת baseline
  function render(){
    setWindowHeight();
    const t = (txtNode.textContent || '').trim() || BASE_TEXT;
    const sizeForText = fitSize(t, availW(), availH());
    const final = Math.min(sizeForText, baselineSize || sizeForText);
    txtNode.style.setProperty('--f', final + 'px');
    setGap();
  }

  // לשוניות
  tabs.forEach((b, i)=>{
    if (b.dataset.font === defFont) { b.classList.add('active'); b.setAttribute('aria-selected','true'); }
    b.addEventListener('click', ()=>{
      tabs.forEach(x=>{x.classList.remove('active'); x.setAttribute('aria-selected','false');});
      b.classList.add('active'); b.setAttribute('aria-selected','true');
      setFamily(b.dataset.font);
    });
  });

  // קיצורי מקלדת: 1–4 משקל | חיצים ←/→ נאג׳ עדין
  window.addEventListener('keydown', (e)=>{
    if (['ArrowLeft','ArrowRight'].includes(e.key)){
      e.preventDefault();
      nudge += (e.key === 'ArrowRight' ? 2 : -2);
      render();
    }
    if (/^[1-4]$/.test(e.key)){
      const idx = parseInt(e.key, 10) - 1;
      if (tabs[idx]) tabs[idx].click();
    }
  });

  // מאזינים
  setFamily(defFont);
  window.addEventListener('resize', ()=>{ baselineSize = fitSize(BASE_TEXT, availW(), baselineH()); render(); }, {passive:true});
  txtNode.addEventListener('input', render);
  txtNode.addEventListener('focus', ()=> txtNode.style.outline='none');
})();
</script>

</body>
</html>
